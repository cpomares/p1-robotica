



<!doctype html>
<html lang="es" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copiar al portapapeles">
      
        <meta name="lang:clipboard.copied" content="Copiado al portapapeles">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No se encontraron documentos">
      
        <meta name="lang:search.result.one" content="1 documento encontrado">
      
        <meta name="lang:search.result.other" content="# documentos encontrados">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.4.0">
    
    
      
        <title>Tema 8: Entrada / salida - P1 Robótica</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.0284f74d.css">
      
        <link rel="stylesheet" href="../../assets/stylesheets/application-palette.01803549.css">
      
      
        
        
        <meta name="theme-color" content="#009688">
      
    
    
      <script src="../../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="teal" data-md-color-accent="teal">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#tema-8-entrada-salida" tabindex="1" class="md-skip">
        Saltar a contenido
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="P1 Robótica" class="md-header-nav__button md-logo">
          
            <img src="../../imagenes/logo.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              P1 Robótica
            </span>
            <span class="md-header-nav__topic">
              
                Tema 8: Entrada / salida
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Búsqueda" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Teclee para comenzar búsqueda
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="P1 Robótica" class="md-nav__button md-logo">
      
        <img src="../../imagenes/logo.png" width="48" height="48">
      
    </a>
    P1 Robótica
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Teoría
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Teoría
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../tema00-descripcion-asignatura/tema00-descripcion-asignatura.html" title="Tema 0: Descripción de la asignatura" class="md-nav__link">
      Tema 0: Descripción de la asignatura
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tema01-introduccion-a-la-programacion/tema01-introduccion-a-la-programacion.html" title="Tema 1: Introducción a la programación" class="md-nav__link">
      Tema 1: Introducción a la programación
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tema02-tipos-de-datos-simples/tema02-tipos-de-datos-simples.html" title="Tema 2: Tipos de datos simples" class="md-nav__link">
      Tema 2: Tipos de datos simples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../tema03-sentencias-de-control/tema03-sentencias-de-control.html" title="Tema 3: Sentencias de control" class="md-nav__link">
      Tema 3: Sentencias de control
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Prácticas
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Prácticas
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../Practicas/practica00/practica00.html" title="Práctica 0: Entorno Linux y herramientas" class="md-nav__link">
      Práctica 0: Entorno Linux y herramientas
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Practicas/practica01/practica01.html" title="Práctica 1: Tipos de datos simples" class="md-nav__link">
      Práctica 1: Tipos de datos simples
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Practicas/practica02/practica02.html" title="Práctica 2: Sentencias de selección" class="md-nav__link">
      Práctica 2: Sentencias de selección
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../Practicas/practica03/practica03.html" title="Práctica 3: Sentencias de iteración" class="md-nav__link">
      Práctica 3: Sentencias de iteración
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Tabla de contenidos</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-introduccion" title="1. Introducción" class="md-nav__link">
    1. Introducción
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-ficheros" title="1.1 Ficheros" class="md-nav__link">
    1.1 Ficheros
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-streams-flujos-de-es" title="1.2 Streams (flujos) de E/S" class="md-nav__link">
    1.2 Streams (flujos) de E/S
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-manejo-de-ficheros" title="2. Manejo de ficheros" class="md-nav__link">
    2. Manejo de ficheros
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file" title="FILE*" class="md-nav__link">
    FILE*
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21-abrir-el-fichero" title="2.1 Abrir el fichero" class="md-nav__link">
    2.1 Abrir el fichero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-cerrar-un-fichero" title="2.2 Cerrar un fichero" class="md-nav__link">
    2.2 Cerrar un fichero
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-funciones-de-entrada-y-salida-para-ficheros" title="2.3 Funciones de entrada y salida para ficheros" class="md-nav__link">
    2.3 Funciones de entrada y salida para ficheros
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#lectura-y-escritura-de-lineas-completas-fgetsy-fputs" title="Lectura y escritura de líneas completas: fgetsy fputs" class="md-nav__link">
    Lectura y escritura de líneas completas: fgetsy fputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funciones-de-entrada-y-salida-para-archivos-binarios-fready-fwrite" title="Funciones de entrada y salida para archivos binarios: fready fwrite" class="md-nav__link">
    Funciones de entrada y salida para archivos binarios: fready fwrite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#funciones-de-entrada-y-salida-para-tipos-de-datos-compuestos" title="Funciones de entrada y salida para tipos de datos compuestos" class="md-nav__link">
    Funciones de entrada y salida para tipos de datos compuestos
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ejercicios-propuestos" title="Ejercicios propuestos" class="md-nav__link">
    Ejercicios propuestos
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="tema-8-entrada-salida">Tema 8: Entrada / salida<a class="headerlink" href="#tema-8-entrada-salida" title="Permanent link">&para;</a></h1>
<h2 id="1-introduccion">1. Introducción<a class="headerlink" href="#1-introduccion" title="Permanent link">&para;</a></h2>
<p>C ofrece un conjunto de funciones para realizar operaciones de entrada y salida (E/S) con las cuales puedes leer y escribir cualquier tipo de fichero.</p>
<p>El manejo de archivos en C se hace mediante el concepto de flujo (<em>streams</em>) o canal. Los flujos pueden estar abiertos o cerrados, y conducen los datos entre el programa y los dispositivos externos.</p>
<h3 id="11-ficheros">1.1 Ficheros<a class="headerlink" href="#11-ficheros" title="Permanent link">&para;</a></h3>
<ul>
<li>Toda la información manejada hasta ahora se pierde cuando termina la ejecución de un programa, tanto la introducida como la generada.</li>
<li>Si tenemos que manejar una gran cantidad de información (un número elevado de variables, valores, etc.) no parece razonable definir esa información en el código.</li>
<li>Además, puede que la información a tratar no la tengamos, sino que queramos procesar información que nos suministran almacenada.</li>
<li>Un fichero almacena de manera permanente la información, usando la memoria permanente (disco duro) del ordenador.</li>
<li>Para C todo en el ordenador es un fichero: teclado, impresora, cualquier otro dispositivo conectado al ordenador.</li>
</ul>
<h3 id="12-streams-flujos-de-es">1.2 <em>Streams</em> (flujos) de E/S<a class="headerlink" href="#12-streams-flujos-de-es" title="Permanent link">&para;</a></h3>
<p>Un <em>stream</em> (flujo) es una abstracción que se refiere a un conjunto de datos que fluye entre un origen y un destino. Entre el origen y el destino debe existir una conexión o canal (<em>pipe</em>) por el que circulen los datos.</p>
<p>Cuando se crea o abre un fichero, se crea un <strong><em>stream</em></strong> asociado al fichero, y se genera un descriptor de archivo para poder identificarlo.</p>
<p>Además, se crea un <strong><em>buffer</em></strong> (almacén intermedio) por donde pasan los datos del archivo. Se utiliza para optimizar las lecturas y escrituras, sobre todo si se realizan de pocos datos y de forma continua.</p>
<p>Se puede pensar en el buffer como un array donde se van almacenando los datos dirigidos al archivo o desde el archivo. El buffer se vuelca cuando de una forma u otra se da la orden de vaciarlo.</p>
<p>Todo archivo abierto lleva asociado un puntero de posición que indica el lugar donde realizará la siguiente lectura o escritura. Cuando se crea un archivo, el <strong>puntero de la posición</strong> es cero (inicio). Se va actualizando conforme se lee o se escribe. Se puede indicar una nueva posición con la función <em>fseek</em>.</p>
<p>Hay dos tipos de <em>streams</em>:</p>
<ul>
<li>Uno es el <em>stream</em> de <strong>texto</strong>, consistente en líneas de texto. Una línea es una secuencia de caracteres terminada en el carácter de línea nueva ('\n' ó '\r\n').</li>
<li>El otro formato es el del <em>stream</em> <strong>binario</strong>, que consiste en una secuencia de bytes que representan datos internos como números, estructuras o arrays. Se utiliza principalmente para datos que no son de tipo texto, pueden contener cualquier información. La codificación de estos ficheros ha de estar especificada mediante un estándar o con la documentación del programa.</li>
</ul>
<p>En el momento de abrir o crear un <em>stream</em>, hay que indicar de qué tipo de archivo se trata:</p>
<ul>
<li><strong>Texto</strong>. Formado por líneas de caracteres, terminadas en un salto de línea.</li>
<li><strong>Binario</strong>. Formado por una secuencia ordenada de caracteres, sin separadores especiales, que pueden almacenar cualquier tipo de información.</li>
</ul>
<p>No hay diferencia real entre uno y otro, salvo que en un fichero en modo texto hay fines de línea y hay funciones de ficheros que pueden buscarlos. Si se abre en modo binario, la información puede ser de cualquier tipo y las funciones de ficheros no buscarán fines de línea.</p>
<h2 id="2-manejo-de-ficheros">2. Manejo de ficheros<a class="headerlink" href="#2-manejo-de-ficheros" title="Permanent link">&para;</a></h2>
<p>Cuando trabajamos con ficheros se suele usar el mismo esquema, tanto si escribimos como si leemos:</p>
<ul>
<li>Abrir el fichero</li>
<li>Comprobar si el fichero está abierto</li>
<li>Si está abierto, leer/escribir en él hasta que se encuentra el fin de fichero</li>
<li>Cerrar el fichero</li>
</ul>
<h3 id="file"><code>FILE*</code><a class="headerlink" href="#file" title="Permanent link">&para;</a></h3>
<p><code>FILE*</code> es la estructura que representa un archivo y se encuentra en la cabecera <code>stdio.h</code>. Esta estructura contiene información sobre el archivo, como la dirección del <em>buffer</em>, el modo de apertura,el último carácter leído, o el indicador de posición de fichero.<br />
Los campos de <code>FILE*</code>pueden cambiar de un compilador a otro.</p>
<p>Ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">FILE</span> <span class="o">*</span><span class="n">ptr_fich</span><span class="p">;</span>
<span class="kt">FILE</span> <span class="o">*</span><span class="nf">mostrar</span><span class="p">();</span>  <span class="c1">// prototipo de función</span>
</pre></div>
</td></tr></table>

<h3 id="21-abrir-el-fichero">2.1 Abrir el fichero<a class="headerlink" href="#21-abrir-el-fichero" title="Permanent link">&para;</a></h3>
<p>Para trabajar con un archivo, la primera operación que hay que realizar es abrirlo. La apertura conecta el archivo externo con el programa, y hay que indicarle cómo se va a tratar: binario, de caracteres. etc. El programa accede a los archivos a través de <code>FILE*</code>, la función de apertura devuelve dicho puntero.</p>
<p>La función <code>fopen</code> abre o crea un fichero:</p>
<p>Sintaxis:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">FILE</span><span class="o">*</span> <span class="n">fopen</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">nombre</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">modo</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Los parámetros que recibe <code>fopen</code> son:</p>
<ul>
<li><code>nombre</code>: cadena de caracteres con la ruta del fichero a abrir</li>
<li><code>modo</code>: cadena de caracteres que indica cómo vamos a abrir el fichero. Lo veremos más adelante.</li>
</ul>
<p>La función <code>fopen</code> devuelve un puntero de tipo <code>FILE</code>. Si ha ocurrido algún error al abrirse, devuelve NULL.</p>
<p>El parámetro <code>modo</code> es una combinación de los caracteres r (read, lectura), w (write, escritura), b (binario), a (append, añadir), y + (actualizar).</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#include</span> <span class="cpf">&lt;stdio.h&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;stdlib.h&gt;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">name</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;notas.txt&quot;</span><span class="p">;</span>

   <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error al abrir el archivo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Archivo abierto con éxito</span>
   <span class="p">}</span>
</pre></div>
</td></tr></table>

<h4>Modos de apertura de un archivo</h4>
<p>El segundo parámetro de <code>fopen</code>indica el modo de tratar el archivo: lectura, escritura, añadido, texto o binario.</p>
<p>Por defecto siempre el archivo es de texto. Se utiliza la letra <code>b</code>para modo binario como último carácter. Algunos compiladores admiten la letra <code>t</code>al final para archivos de texto.</p>
<ul>
<li><strong>"r"</strong> modo lectura. El flujo se posiciona al principio del fichero.</li>
<li><strong>"r+"</strong> modo lectura y escritura. El flujo se posiciona al principio del fichero</li>
<li><strong>"w"</strong> modo escritura. Si el fichero no existe, se crea. Si existe, se trunca a 0. El flujo se posiciona al principio del fichero</li>
<li><strong>"w+"</strong> modo lectura y escritura. Si el fichero no existe, se crea. Si existe, se trunca a 0. El flujo se posiciona al principio del fichero</li>
<li><strong>"a"</strong> modo escritura añadir al final. Si el fichero no existe, se crea. El flujo se posiciona al final del fichero.</li>
<li><strong>"a+"</strong> modo lectura y escritura añadir al final. Si el fichero no existe, se crea. El flujo se posiciona al final del fichero.</li>
<li>Podemos combinar modos: <strong>"rw"</strong></li>
</ul>
<p>Para abrir un archivo binario:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="ss">&quot;rb&quot;</span><span class="p">,</span> <span class="ss">&quot;wb&quot;</span><span class="p">,</span> <span class="ss">&quot;ab&quot;</span><span class="p">,</span> <span class="ss">&quot;r+b&quot;</span><span class="p">,</span> <span class="ss">&quot;w+b&quot;</span><span class="p">,</span> <span class="ss">&quot;a+b&quot;</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Tenemos un archivo de texto de lectura "licencia,txt" y queremos grabar los datos procesados en un archivo binario "resumen.dat". Las operaciones de apertura son:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">pf1</span><span class="p">,</span> <span class="o">*</span><span class="n">pf2</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">org</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;licencia.txt&quot;</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">dest</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;resumen.dat&quot;</span><span class="p">;</span>

   <span class="n">pf1</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">org</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
   <span class="n">pf2</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">);</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">fp1</span> <span class="o">==</span> <span class="nb">NULL</span> <span class="o">||</span> <span class="n">fp2</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// Error</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="22-cerrar-un-fichero">2.2 Cerrar un fichero<a class="headerlink" href="#22-cerrar-un-fichero" title="Permanent link">&para;</a></h3>
<p>Los archivos en C trabajan con una memoria intermedia llamada <em>buffer</em>. La entrada y salida de datos se almacena en ese <em>buffer</em>, volcándose cuando está lleno.
Siempre que se termina de trabajar con un fichero y siempre que se termine la ejecución de un programa, hay que cerrar los ficheros abiertos para que, entre otras cosas, se vuelque el <em>buffer</em> y no queden datos sin actualizar.</p>
<p>La función <code>fclose</code> cierra un fichero.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">fclose</span><span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<ul>
<li>La función devuelve 0 si se cerró con éxito</li>
<li>Cuando se termina la ejecución de un programa, el sistema operativo se "suele" encargar de cerrar todos los ficheros abiertos</li>
<li>Si no cerramos los ficheros abiertos podemos tener problemas.</li>
</ul>
<p>Ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5
6
7</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f1</span><span class="p">,</span> <span class="o">*</span><span class="n">f2</span><span class="p">;</span>

<span class="n">f1</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;datos.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;arbol.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>

<span class="n">fclose</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
<span class="n">fclose</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="23-funciones-de-entrada-y-salida-para-ficheros">2.3 Funciones de entrada y salida para ficheros<a class="headerlink" href="#23-funciones-de-entrada-y-salida-para-ficheros" title="Permanent link">&para;</a></h3>
<ul>
<li>La estructura <code>FILE</code> contiene una posición (marca) de por dónde vamos leyendo en el fichero.</li>
<li>Si leemos algo del fichero, la marca avanza hasta el siguiente carácter/dato disponible.</li>
<li>Si volvemos a leer del fichero, leemos a partir de la marca.</li>
<li>Para saber si hemos llegado al final del fichero, usaremos la función <code>feof (FILE *f)</code> (devuelve 0 si no se ha encontrado).</li>
</ul>
<h4>Funciones de entrada y salida de caracteres: <code>fgetc</code>y <code>fputc</code></h4>
<p><code>fputc</code>escribe un carácter en el archivo asociado con el puntero a <code>FILE</code>. Devuelve <code>EOF</code>si no puede escribirse. Si todo es correcto, avanza el puntero de posición.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">fputc</span> <span class="p">(</span><span class="kt">int</span> <span class="n">cara</span><span class="err">́</span><span class="n">cter</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Lee caracteres desde teclado hasta introducir la 'Z', y los va grabando uno a uno en el fichero:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">salida</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;salida.txt&quot;</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">((</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">salida</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error en la apertura del fichero&quot;</span><span class="p">);</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">do</span> <span class="p">{</span>
         <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">);</span>
         <span class="n">fputc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">c</span> <span class="o">!=</span> <span class="sc">&#39;Z&#39;</span><span class="p">);</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p><code>fgetc</code> devuelve el carácter siguiente del archivo (<em>stream</em>). Devuelve el carácter <code>EOF</code> si hemos llegado al final del fichero.</p>
<p>Sintaxis:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">fgetc</span> <span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Imprime por pantalla el contenido del fichero carácter a carácter y el número de líneas que contiene:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">salida</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;salida.txt&quot;</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">((</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">salida</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error en la apertura del fichero&quot;</span><span class="p">);</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">((</span><span class="n">c</span> <span class="o">=</span> <span class="n">fgetc</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">){</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">n</span><span class="o">++</span><span class="p">;</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
         <span class="p">}</span> <span class="k">else</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%c&quot;</span><span class="p">,</span> <span class="n">c</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Número de líneas del archivo: %d&quot;</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ejemplo con <code>fputc</code>y <code>fgetc</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f1</span><span class="p">,</span> <span class="o">*</span><span class="n">f2</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">ch</span><span class="p">;</span>

   <span class="n">f1</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.txt&quot;</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">);</span>
   <span class="n">f2</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file2.txt&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">f1</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error al abrir file1.txt</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">f2</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error al abrir file2.txt </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
         <span class="n">fclose</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
         <span class="c1">//Bucle de copia carácter a carácter</span>
         <span class="k">while</span><span class="p">((</span><span class="n">ch</span> <span class="o">=</span> <span class="n">fgetc</span><span class="p">(</span><span class="n">f1</span><span class="p">))</span> <span class="o">!=</span> <span class="n">EOF</span><span class="p">)</span>
             <span class="n">fputc</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span><span class="n">f2</span><span class="p">);</span>

         <span class="n">fclose</span><span class="p">(</span><span class="n">f1</span><span class="p">);</span>
         <span class="n">fclose</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>

      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="lectura-y-escritura-de-lineas-completas-fgetsy-fputs">Lectura y escritura de líneas completas: <code>fgets</code>y <code>fputs</code><a class="headerlink" href="#lectura-y-escritura-de-lineas-completas-fgetsy-fputs" title="Permanent link">&para;</a></h3>
<p>Estas funciones escriben / leen una cadena de caracteres en el archivo asociado.</p>
<p>La función <code>fputs</code>escribe una cadena de caracteres. Devuelve <code>EOF</code>si no ha podido escribir la cadena, y un valor no negativo si la escritura es correcta.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">fputs</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">cadena</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>La función <code>fgets</code> lee una cadena de caracteres del archivo. Termina cuando lee el fin de línea (línea completa) o bien cuando ha leído <code>tam-1</code>caracteres, siendo <code>tam</code>un número entero de la función. Devuelve un puntero a la cadena devuelta o <code>NULL</code>si ha habido error.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">char</span> <span class="o">*</span><span class="n">fgets</span> <span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">cadena</span><span class="p">,</span> <span class="kt">int</span> <span class="n">tam</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Le indicamos con <code>tam</code> cuántos caracteres leer. Si encuentra un <code>\n</code> solo devuelve lo leído hasta ese carácter (incluido). El valor leído se guarda en <code>cadena</code> y también se devuelve. Si se ha producido un error (fin de fichero, por ejemplo) se devuelve NULL.</p>
<p>Ejemplo: Lectura de un máximo de 80 caracteres:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#define T 81 </span><span class="c1">// contamos el &#39;\0&#39;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="n">cad</span><span class="p">[</span><span class="n">T</span><span class="p">];</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>

   <span class="c1">// instrucciones para abrir el fichero</span>

   <span class="n">fgets</span><span class="p">(</span><span class="n">cad</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Copiar ficheros línea a línea modo texto</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#define TAM 100</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f2</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">cad</span><span class="p">[</span><span class="n">TAM</span><span class="p">];</span>

   <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;ejemplo1.c&quot;</span><span class="p">,</span><span class="s">&quot;r&quot;</span><span class="p">);</span>
   <span class="n">f2</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;ejemplo3.c&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error al abrir ejemplo1.c</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">f2</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error al abrir ejemplo2.c </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
         <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">else</span> <span class="p">{</span>
         <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">cad</span><span class="p">,</span> <span class="n">TAM</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span>
               <span class="n">fputs</span><span class="p">(</span><span class="n">cad</span><span class="p">,</span> <span class="n">f2</span><span class="p">);</span>
         <span class="p">}</span>

         <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
         <span class="n">fclose</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h4>Lectura y escritura con formato: <code>fscanf</code>y <code>fprintf</code></h4>
<p>La función <code>fscanf</code>permite leer datos de un <em>stream</em>. Todos los formatos y opciones de <code>scanf</code>se pueden aplicar a <code>fscanf</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">fscanf</span> <span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span><span class="n">formato</span><span class="p">...)</span>
</pre></div>
</td></tr></table>

<p>Ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">(){</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">c</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">cad</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>

   <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;ejemplo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">f</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">!</span> <span class="n">feof</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">fscanf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;%d %c %s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">c</span><span class="p">,</span> <span class="n">cad</span><span class="p">);</span>

         <span class="c1">// aquí continuaría el código</span>
      <span class="p">}</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ejercicio: Crea un archivo de txt compatible con el ejemplo anterior y pruébalo.</p>
<p>Para escribir datos con formato en un <em>stream</em> se usa <code>fprintf</code>. Todos los formatos y opciones de <code>printf</code>se pueden aplicar a <code>fprintf</code>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">fprintf</span> <span class="p">(</span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="kt">char</span> <span class="o">*</span> <span class="n">formato</span><span class="p">...)</span>
</pre></div>
</td></tr></table>

<p>Ejemplo:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">descriptor</span><span class="p">;</span>

   <span class="c1">// Creamos el archivo y lo abrimos para escritura</span>

   <span class="n">descriptor</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;./ejemplo.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>
   <span class="k">if</span><span class="p">(</span><span class="n">descriptor</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error, no se puede crear el archivo&quot;</span><span class="p">);</span>
   <span class="k">else</span>
      <span class="n">fprintf</span><span class="p">(</span><span class="n">descriptor</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="mi">1234</span><span class="p">);</span>   <span class="c1">// Escribimos algo</span>

   <span class="c1">//Cerramos el archivo</span>
   <span class="n">fclose</span><span class="p">(</span><span class="n">descriptor</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Queremos crear el archivo "datos.dat" de forma que cada línea contenga un registro con los datos de una persona: nombre, fecha nacimiento. Los campos de la estructura se escriben con <code>fprintf</code> en el fichero.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">nombre</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">dia</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">mes</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">anyo</span><span class="p">;</span>
<span class="p">}</span><span class="n">TPersona</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">entrada</span><span class="p">(</span><span class="n">TPersona</span> <span class="o">*</span><span class="n">p</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">file</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;datos.dat&quot;</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">resp</span> <span class="o">=</span> <span class="sc">&#39;S&#39;</span><span class="p">;</span>
   <span class="n">TPersona</span> <span class="n">p</span><span class="p">;</span>

   <span class="n">p</span><span class="p">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">((</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error al abrir el archivo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">toupper</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span> <span class="o">==</span> <span class="sc">&#39;S&#39;</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">entrada</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">);</span>
         <span class="n">fprintf</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&quot;%s %d-%d-%d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">dia</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">mes</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">anyo</span><span class="p">);</span>
         <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Otro registro?: &quot;</span><span class="p">);</span>
         <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">%c&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">resp</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
      <span class="n">free</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">nombre</span><span class="p">);</span>
      <span class="n">p</span><span class="p">.</span><span class="n">nombre</span> <span class="o">=</span> <span class="nb">NULL</span><span class="p">;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">entrada</span><span class="p">(</span><span class="n">TPersona</span> <span class="o">*</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="n">cad</span><span class="p">[</span><span class="mi">25</span><span class="p">];</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Nombre: &quot;</span><span class="p">);</span>
   <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">cad</span><span class="p">);</span>
   <span class="n">p</span><span class="o">-&gt;</span><span class="n">nombre</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="o">*</span><span class="p">)</span><span class="n">realloc</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">nombre</span><span class="p">,</span> <span class="p">(</span><span class="n">strlen</span><span class="p">(</span><span class="n">cad</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">char</span><span class="p">));</span>
   <span class="n">strcpy</span><span class="p">(</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">nombre</span><span class="p">,</span> <span class="n">cad</span><span class="p">);</span>
   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Fecha nacimiento (dd mm aaaa): &quot;</span><span class="p">);</span>
   <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d %d %d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">dia</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">mes</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="o">-&gt;</span><span class="n">anyo</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="funciones-de-entrada-y-salida-para-archivos-binarios-fready-fwrite">Funciones de entrada y salida para archivos binarios: <code>fread</code>y <code>fwrite</code><a class="headerlink" href="#funciones-de-entrada-y-salida-para-archivos-binarios-fready-fwrite" title="Permanent link">&para;</a></h3>
<p>Para abrir un archivo en modo binario hay que especificar la opción <em>b</em> en el modo de apertura. Los archivos binarios son secuencias de 0s y 1s, bloques de datos. Optimizan la memoria ocupada por un archivo, sobre todo con campos numéricos. Por ejemplo, para almacenar un entero, ocupa 2 <em>bytes</em>. Para leer un archivo binario se ha de realizar en modo binario y sólo se pueden visualizar desde el entorno de un programa C. Modos de apertura binario:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="ss">&quot;rb&quot;</span><span class="p">,</span> <span class="ss">&quot;wb&quot;</span><span class="p">,</span> <span class="ss">&quot;ab&quot;</span><span class="p">,</span> <span class="ss">&quot;r+b&quot;</span><span class="p">,</span> <span class="ss">&quot;w+b&quot;</span><span class="p">,</span> <span class="ss">&quot;a+b&quot;</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Abrir tres archivos en modo binario</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">FILE</span> <span class="o">*</span><span class="n">f1</span><span class="p">,</span> <span class="o">*</span><span class="n">f2</span><span class="p">,</span> <span class="o">*</span><span class="n">f3</span><span class="p">;</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file1.ene&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">);</span>  <span class="c1">// lectura binario</span>
<span class="n">f2</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file2.feb&quot;</span><span class="p">,</span> <span class="s">&quot;w+b&quot;</span><span class="p">);</span> <span class="c1">// leer/escribir binario</span>
<span class="n">f3</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;file3.mar&quot;</span><span class="p">,</span> <span class="s">&quot;ab&quot;</span><span class="p">);</span>  <span class="c1">// añadir a archivo binario</span>
</pre></div>
</td></tr></table>

<p><code>fwrite</code>escribe un buffer de cualquier tipo de dato en un archivo binario. Permite escribir un número <code>num_el</code>de elementos, de tamaño <code>tam_el</code>, desde una zona de memoria indicada por <code>puntero</code>, a un <em>stream</em>.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">size_t</span> <span class="n">fwrite</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">puntero</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">tam_el</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">num_el</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">stream</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Guardamos en un archivo binario un conjunto de puntos:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
   <span class="kt">int</span> <span class="n">x</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">y</span><span class="p">;</span>
<span class="p">}</span><span class="n">TPunto</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">TPunto</span> <span class="n">p</span><span class="p">;</span>
   <span class="kt">char</span> <span class="o">*</span><span class="n">file</span> <span class="o">=</span> <span class="s">&quot;puntos.dat&quot;</span><span class="p">;</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">((</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s">&quot;wb&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error en la apertura del fichero</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">do</span> <span class="p">{</span>
         <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Introduce las coordenadas del punto. Para acabar (0 0): &quot;</span><span class="p">);</span>
         <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d %d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">.</span><span class="n">x</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">.</span><span class="n">y</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">p</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">TPunto</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
      <span class="p">}</span><span class="k">while</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">x</span> <span class="o">!=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">p</span><span class="p">.</span><span class="n">y</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>La función <code>fread</code>lee de un archivo n bloques de bytes y lo almacena en un buffer. El número de bytes de cada bloque (tamaño) se pasa como parámetro, al igual que el número n de bloques y la dirección del buffer o variable donde se almacena. La función devuelve el número de bloques que lee y debe coincidir con n.</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">size_t</span> <span class="n">fread</span> <span class="p">(</span><span class="kt">void</span> <span class="o">*</span><span class="n">puntero</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">tam</span><span class="p">,</span> <span class="kt">size_t</span> <span class="n">n</span><span class="p">,</span> <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">)</span>
</pre></div>
</td></tr></table>

<p>Ejemplo: Abrir archivo en modo binario para lectura. Leer el archivo hasta el final y cada lectura es un número real que se acumula en la variable <code>suma</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">;</span>
   <span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="n">suma</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>

   <span class="k">if</span> <span class="p">((</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;reales.num&quot;</span><span class="p">,</span> <span class="s">&quot;rb&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Error al abrir el archivo</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="p">{</span>
         <span class="n">fread</span><span class="p">(</span><span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">double</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
         <span class="n">suma</span> <span class="o">+=</span> <span class="n">x</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ejemplos de escritura de array de enteros en archivos binarios (la lectura es igual):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="n">arr</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">};</span>
<span class="c1">// Escribe el array entero:</span>
<span class="n">fwrite</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">arr</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<span class="c1">//Escribe los dos primeros elementos del array:</span>
<span class="n">fwrite</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="kt">int</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<p>Ejemplos de escritura de array de <code>structs</code> en archivos binarios (usamos el <code>TPunto</code> definido previamente):</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span>1
2
3
4
5</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="n">TPunto</span> <span class="n">puntos</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">},{</span><span class="mi">3</span><span class="p">,</span><span class="mi">5</span><span class="p">},{</span><span class="mi">6</span><span class="p">,</span><span class="mi">2</span><span class="p">}</span> <span class="p">};</span>
<span class="c1">// Escribe el array entero:</span>
<span class="n">fwrite</span><span class="p">(</span><span class="n">puntos</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">puntos</span><span class="p">),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
<span class="c1">//Escribe los dos primeros elementos del array:</span>
<span class="n">fwrite</span><span class="p">(</span><span class="n">puntos</span><span class="p">,</span> <span class="k">sizeof</span><span class="p">(</span><span class="n">TPunto</span><span class="p">),</span> <span class="mi">2</span><span class="p">,</span> <span class="n">fp</span><span class="p">);</span>
</pre></div>
</td></tr></table>

<h3 id="funciones-de-entrada-y-salida-para-tipos-de-datos-compuestos">Funciones de entrada y salida para tipos de datos compuestos<a class="headerlink" href="#funciones-de-entrada-y-salida-para-tipos-de-datos-compuestos" title="Permanent link">&para;</a></h3>
<p>Si tenemos que escribir una estructura o registro en un <em>stream</em>, se puede hacer de dos formas:</p>
<ul>
<li>Escribir uno a uno cada uno de los campos, utilizando funciones como <code>printf</code>, etc.</li>
<li>Escribir toda la estructura a la vez usando la función <code>fwrite</code>, indicando la dirección de comienzo y el tamaño del registro en bytes (obtenido con <code>sizeof</code>). Lo hemos vistro previamente con el ejemplo del punto.</li>
</ul>
<p>La segunda estrategia es más eficiente. En el siguiente ejemplo vemos las dos formas:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#define TAMCAD 15</span>

<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
   <span class="kt">char</span> <span class="n">nombre</span><span class="p">[</span><span class="n">TAMCAD</span><span class="p">];</span>
   <span class="kt">char</span> <span class="n">apellidos</span><span class="p">[</span><span class="n">TAMCAD</span><span class="p">];</span>
   <span class="kt">int</span> <span class="n">edad</span><span class="p">;</span>
<span class="p">}</span><span class="n">TPersona</span><span class="p">;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="n">TPersona</span> <span class="n">alumno</span><span class="p">;</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="o">*</span><span class="n">f2</span><span class="p">;</span>

   <span class="n">strcpy</span><span class="p">(</span><span class="n">alumno</span><span class="p">.</span><span class="n">nombre</span><span class="p">,</span> <span class="s">&quot;Pepe&quot;</span><span class="p">);</span>
   <span class="n">strcpy</span><span class="p">(</span><span class="n">alumno</span><span class="p">.</span><span class="n">apellidos</span><span class="p">,</span> <span class="s">&quot;Garcia Sanchez&quot;</span><span class="p">);</span>
   <span class="n">alumno</span><span class="p">.</span><span class="n">edad</span> <span class="o">=</span> <span class="mi">25</span><span class="p">;</span>

   <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;alumno.dat&quot;</span><span class="p">,</span><span class="s">&quot;wb&quot;</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error al abrir fichero</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Escribimos el registro de una sola vez</span>
      <span class="n">fwrite</span><span class="p">(</span><span class="o">&amp;</span><span class="n">alumno</span><span class="p">,</span>         <span class="c1">// dirección de comienzo</span>
             <span class="k">sizeof</span><span class="p">(</span><span class="n">alumno</span><span class="p">),</span>  <span class="c1">// tamaño</span>
             <span class="mi">1</span><span class="p">,</span>               <span class="c1">// número de elementos</span>
             <span class="n">f</span><span class="p">);</span>              <span class="c1">// descriptor del fichero</span>

      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
   <span class="p">}</span>

   <span class="n">f2</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;alumno.txt&quot;</span><span class="p">,</span><span class="s">&quot;w&quot;</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">f2</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error al abrir fichero</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>

      <span class="c1">// Escribimos a continuación el registro campo a campo</span>
      <span class="n">fprintf</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">alumno</span><span class="p">.</span><span class="n">nombre</span><span class="p">);</span>
      <span class="n">fprintf</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">alumno</span><span class="p">.</span><span class="n">apellidos</span><span class="p">);</span>
      <span class="n">fprintf</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span> <span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="n">alumno</span><span class="p">.</span><span class="n">edad</span><span class="p">);</span>

      <span class="n">fclose</span><span class="p">(</span><span class="n">f2</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<p>Ejemplo pasando el nombre del fichero como parámetro a <code>main</code>:</p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#define TAM 2048</span>

<span class="c1">// Ejemplo de lectura y escritura binaria, pasamos el nombre del fichero como parámetro a main</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">fe</span><span class="p">,</span> <span class="o">*</span><span class="n">fs</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="n">TAM</span><span class="p">];</span>
   <span class="kt">int</span> <span class="n">bytesLeidos</span><span class="p">;</span>

   <span class="c1">// Abrir el fichero de entrada en lectura y binario</span>
   <span class="n">fe</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>

   <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fe</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;El fichero %s no existe o no puede ser abierto.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
   <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Crear o sobreescribir el fichero de salida en binario</span>
      <span class="n">fs</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s">&quot;wb&quot;</span><span class="p">);</span>

      <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="n">fs</span><span class="p">)</span> <span class="p">{</span>
         <span class="n">printf</span><span class="p">(</span><span class="s">&quot;El fichero %s no puede ser creado.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
         <span class="n">fclose</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
      <span class="p">}</span><span class="k">else</span> <span class="p">{</span>
      <span class="c1">// Bucle de copia:</span>
         <span class="k">while</span><span class="p">((</span><span class="n">bytesLeidos</span> <span class="o">=</span> <span class="n">fread</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">TAM</span><span class="p">,</span> <span class="n">fe</span><span class="p">)))</span>
            <span class="n">fwrite</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bytesLeidos</span><span class="p">,</span> <span class="n">fs</span><span class="p">);</span>
         <span class="c1">// Cerrar ficheros:</span>
         <span class="n">fclose</span><span class="p">(</span><span class="n">fe</span><span class="p">);</span>
         <span class="n">fclose</span><span class="p">(</span><span class="n">fs</span><span class="p">);</span>
      <span class="p">}</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h3 id="ejercicios-propuestos">Ejercicios propuestos<a class="headerlink" href="#ejercicios-propuestos" title="Permanent link">&para;</a></h3>
<ol>
<li>Hacer un programa que pida palabras al usuario y que las guarde en un fichero. El programa finalizará cuando el usuario introduzca "fin".</li>
<li>Hacer un programa que pregunte el nombre de un fichero. Si existe, deberá mostrar el contenido del fichero de 25 en 25 líneas. Cuando muestre 25 líneas, esperará hasta que el usuario pulse una tecla (<code>getchar</code>) y mostrará las siguientes 25 líneas.</li>
<li>Crear un programa que pida al usuario pares de números enteros y escriba su suma (con el formato <code>20 + 3 = 23</code>) en pantalla y en un fichero llamado "sumas.txt". Cada vez que se ejecute el programa, deberá añadir los nuevos resultados a continuación de los resultados de las ejecuciones anteriores.</li>
</ol>
<h4>Solución ejercicio 1</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#define TAMCAD 60</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span><span class="o">*</span> <span class="n">pf</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">fin</span><span class="p">[]</span><span class="o">=</span><span class="s">&quot;fin&quot;</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">palabra</span><span class="p">[</span><span class="n">TAMCAD</span><span class="p">];</span>

   <span class="n">pf</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;palabras.txt&quot;</span><span class="p">,</span> <span class="s">&quot;w&quot;</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">pf</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;Error al abrir fichero</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="p">}</span>
   <span class="k">else</span> <span class="p">{</span>
      <span class="k">do</span> <span class="p">{</span>
          <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Escriba una palabra (fin para terminar). </span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
          <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="n">palabra</span><span class="p">);</span>

          <span class="k">if</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">palabra</span><span class="p">,</span> <span class="n">fin</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">pf</span><span class="p">,</span> <span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">palabra</span><span class="p">);</span>

       <span class="p">}</span> <span class="k">while</span> <span class="p">(</span><span class="n">strcmp</span><span class="p">(</span><span class="n">palabra</span><span class="p">,</span> <span class="n">fin</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>

      <span class="n">fclose</span><span class="p">(</span><span class="n">pf</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h4>Solución ejercicio 2</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="cp">#define TAMLINEA 100</span>
<span class="cp">#define TAM 20</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
   <span class="kt">FILE</span><span class="o">*</span> <span class="n">f</span><span class="p">;</span>
   <span class="kt">char</span> <span class="n">linea</span><span class="p">[</span><span class="n">TAMLINEA</span><span class="p">],</span> <span class="n">nombre</span><span class="p">[</span><span class="n">TAM</span><span class="p">];</span>
   <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

   <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">Introduzca el nombre de fichero: &quot;</span><span class="p">);</span>
   <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span><span class="n">nombre</span><span class="p">);</span>

   <span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">nombre</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">f</span> <span class="o">!=</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>  <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">fgets</span><span class="p">(</span><span class="n">linea</span><span class="p">,</span> <span class="n">TAMLINEA</span><span class="p">,</span> <span class="n">f</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">feof</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span><span class="n">linea</span><span class="p">);</span>
            <span class="p">}</span>
         <span class="p">}</span>
         <span class="n">getchar</span><span class="p">();</span>
      <span class="p">}</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<h4>Solución ejercicio 3</h4>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
   <span class="kt">FILE</span> <span class="o">*</span><span class="n">resultados</span><span class="p">;</span>
   <span class="kt">int</span> <span class="n">numero1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">numero2</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">suma</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span>

   <span class="k">if</span><span class="p">((</span><span class="n">resultados</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="s">&quot;sumas.txt&quot;</span><span class="p">,</span> <span class="s">&quot;a+&quot;</span><span class="p">))</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;No se pudo abrir el archivo.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
   <span class="k">else</span>
   <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Escriba dos numeros.</span><span class="se">\n\&quot;</span><span class="s">000</span><span class="se">\&quot;</span><span class="s"> para salir.</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
      <span class="k">do</span>
      <span class="p">{</span>
         <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Primer numero: &quot;</span><span class="p">);</span>
         <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">numero1</span><span class="p">);</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">numero1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;Segundo numero: &quot;</span><span class="p">);</span>
            <span class="n">scanf</span><span class="p">(</span><span class="s">&quot;%d&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">numero2</span><span class="p">);</span>
            <span class="n">suma</span> <span class="o">=</span> <span class="n">numero1</span> <span class="o">+</span> <span class="n">numero2</span><span class="p">;</span>
            <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%d + %d = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">numero1</span><span class="p">,</span> <span class="n">numero2</span><span class="p">,</span> <span class="n">suma</span><span class="p">);</span>
            <span class="n">fprintf</span><span class="p">(</span><span class="n">resultados</span><span class="p">,</span> <span class="s">&quot;%d + %d = %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">numero1</span><span class="p">,</span> <span class="n">numero2</span><span class="p">,</span> <span class="n">suma</span><span class="p">);</span>
         <span class="p">}</span>
      <span class="p">}</span>
      <span class="k">while</span> <span class="p">(</span><span class="n">numero1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">);</span>
      <span class="n">fclose</span><span class="p">(</span><span class="n">resultados</span><span class="p">);</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table>

<hr />
<p>Programación 1, Grado de Robótica, curso 2019-20<br />
© Departamento Ciencia de la Computación e Inteligencia Artificial, Universidad de Alicante<br />
Cristina Pomares Puig</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.245445c6.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>